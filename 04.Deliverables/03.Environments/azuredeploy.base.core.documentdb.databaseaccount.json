{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "documentDbDatabaseAccountResourceName": {
            "type": "string",
            "minLength": 3,
            "maxLength": 50,
            "metadata": {
                "description": "The MongoDB database account name. Needs to be globally unique."
            }
        },
        "documentDbDatabaseAccountResourceLocation": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]",
            "allowedValues": [
                "southeastasia",
                "westus",
                "northeurope",
                "westeurope",
                "australiaeast",
                "australiasoutheast"
              ],
              "metadata": {
                  "description": "The region where the read/write database is located."
              }            

        },
        "documentDbDatabaseAccountConsistencyPolicy": {
            "type": "string",
            "defaultValue": "Session",
            "allowedValues": [
                "Eventual",
                "Session",
                "BoundedStaleness",
                "Strong",
                "ConsistentPrefix"
            ],
            "metadata": {
                "description": "The default value is 'Session'."
            }
        },
        "documentDbDatabaseAccountKind": {
            "type": "string",
            "defaultValue": "GlobalDocumentDB",
            "allowedValues": [
                "MongoDB",
                "GlobalDocumentDB",
                "Parse"
            ],
            "metadata": {
                "description": "The kind of Document Db needed. Default is MongoDB"
            }
        },
        "documentDbDatabaseAccountDefaultExperience": {
            "type": "string",
            "defaultValue": "Graph",
            "allowedValues": [
                "Graph"
            ],
            "metadata": {
                "description": "The kind of API to offer"
            }
        },
        "documentDbDatabaseAccountOfferType": {
            "type": "string",
            "defaultValue": "Standard",
            "allowedValues": [
                "Standard"
            ],
            "metadata": {
                "description": "TODO: Only choice is Standard"
            }
        },

        "documentDbDatabaseAccountTags": {
            "type": "object",
            "defaultValue": {},
            "metadata": {
                "description": "A Complex Object (ie, JSON) containing a series of stringKey/stringValues that are added to the target resource as Tags."
            }
        }
    },
    "variables": {
        "idPrefix": "azuredeploy.base.core",
        "documentDb": {
            "databaseAccount": {
                "resourceName": "[toLower(parameters('documentDbDatabaseAccountResourceName'))]",
                "resourceType": "Microsoft.DocumentDB/databaseAccounts",
                "resourceLocation": "[parameters('documentDbDatabaseAccountResourceLocation')]",
                "kind": "[parameters('documentDbDatabaseAccountKind')]",
                "experience": "[parameters('documentDbDatabaseAccountDefaultExperience')]",                
                "offerType": "[parameters('documentDbDatabaseAccountOfferType')]",
                "consistencyPolicy": "[parameters('documentDbDatabaseAccountConsistencyPolicy')]",
                "tags": "[parameters('documentDbDatabaseAccountTags')]"   
            }
        }
    },
    "resources": [
        {
            "apiVersion": "2015-04-08",
            "type": "Microsoft.DocumentDB/databaseAccounts",
            //Name must be lowercase, more than 3, less than 50 characters.
            "name": "test192834756",
            "location": "[variables('documentDb').databaseAccount.resourceLocation]",
            "kind": "[variables('documentDb').databaseAccount.kind]",
            "tags": {
                "defaultExperience": "[variables('documentDb').databaseAccount.experience]"
            },
            "scale":null,
            "properties": {
                // If name not provided, even though not listed in docs, complains.
                //"name": "[variables('documentDb').databaseAccount.resourceName]",
                "name": "test19283475600000",
                "consistencyPolicy": {
                    "defaultConsistencyLevel": "[variables('documentDb').databaseAccount.consistencyPolicy]",
                    "maxIntervalInSeconds": 5,
                    "maxStalenessPrefix": 100
                },
                "databaseAccountOfferType": "[variables('documentDb').databaseAccount.offerType]",
                "locations":[
                    {
                        //This template creates a database account with only one read region. To create the database account with more than one read region, add it to the 'locations' array in the azuredeploy.json file. Failover priority values must be unique and greater than 0 for read regions.

                        "locationName": "[variables('documentDb').databaseAccount.resourceLocation]",
                        "failoverPriority": 0
                      }
                ]
            },
            "tags": "[variables('documentDb').databaseAccount.tags]"
        }
    ],
    "outputs": {
        "resourceId": {
            "value": "[resourceId(variables('documentDb').databaseAccount.resourceType, variables('documentDb').databaseAccount.resourceName)]",
            "type": "string"
          },
          "resourceName": {
            "value": "[variables('documentDb').databaseAccount.resourceName]",
            "type": "string"
          },
          "resourceLocation": {
            "value": "[variables('documentDb').databaseAccount.resourceLocation]",
            "type": "string"
          },
          "kind": {
            "value": "[variables('documentDb').databaseAccount.kind]",
            "type": "string"
          },
          "experience": {
            "value": "[variables('documentDb').databaseAccount.experience]",
            "type": "string"
          },
          "offerType": {
            "value": "[variables('documentDb').databaseAccount.offerType]",
            "type": "string"
          }
      
    }
}